<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="jd.css">
</head>
<body>
<p><div id="nav"><a href="Index.htm">Jd</a>&nbsp;|&nbsp;<a href="Overview.htm">Overview</a>&nbsp;|&nbsp;<a href="General.htm">General</a>&nbsp;|&nbsp;<a href="Ops.htm">Ops</a>&nbsp;|&nbsp;<a href="Admin.htm">Admin</a>&nbsp;|&nbsp;<a href="Guide.htm">Guide</a>&nbsp;|&nbsp;<a href="Technical.htm" class="act">Technical</a>&nbsp;|&nbsp;<a href="Release.htm">Release</a>&nbsp;|&nbsp;<a href="Convert.htm">Convert</a>&nbsp;|&nbsp;<a href="License.htm">License</a>&nbsp;|&nbsp;<a href="Support.htm">Support</a></div></p>
<h2 id="backup">Backup</h2>
<p>Complete backup or restore is just a copy of the db file folder. Host shell scripts can provide full backup/restore. With large databases and suitable hardware it might be worthwhile to use multiple tasks and use compression.</p>
<p>CSV dump/restore also provides complete backup.</p>
<h2 id="damaged">Damaged</h2>
<p>See tutorial log.</p>
<p>There are many ways a database can be damaged: hardware crashes, OS crashes, JD bugs, application bugs...</p>
<p>A simple example is a table where different cols have different counts. A db with such tables can work in some cases, get unexpected errors, result in further damage (that obscure the orignal problem), or in the worst case give wrong answers.</p>
<p>When a col is used that has a bad count (not the same table TLen) the db is marked as damaged.</p>
<p><code>jd'validate'</code> checks the integrity of the db (all tables, columns, files) and if there is a problem, marks the db as damaged and signals an error.</p>
<p><code>jdadmin</code> does a validate to ensure the db is ready for use.</p>
<p>Validation details can be seen with:</p>
<pre><code>   jd&#39;info validate&#39;     NB. complete info
   jd&#39;info validatebad&#39;  NB. info about problems</code></pre>
<p>The db is marked as damaged and a jdlog record is written if a validation fails.</p>
<h2 id="developer">Developer</h2>
<p>Jd is distributed with JAL (Package Manager) and the Jd library is at ~addons/data/jd and is accessed with the following equivalent lines:</p>
<pre><code>   load&#39;jd&#39;
   load&#39;~addons/data/jd/jd.ijs&#39;</code></pre>
<p>A developer works with a local repo. Use the development library with something like:</p>
<pre><code>   load&#39;~/dev/addons/data/jd/jd.ijs&#39;</code></pre>
<p>Loading jd.ijs sets JDP_z_ as the path to the Jd library and this is used for all library references.</p>
<p>An automated process copies the developer repo to the addon svn repo to build a new Jd release.</p>
<h2 id="file-handles">File handles</h2>
<p>Jd requires lots of file handles. Using thousands of columns requires thousands of handles.</p>
<p>Jd fails badly if it runs out of handles. Unable to access a file, an error is signaled, perhaps in the middle of an operation that will leave the database damaged.</p>
<p>Windows user does not have a limit on file handles.</p>
<p>Linux/Mac user often has low soft and hard limits on handles and this must be increased for serious use of Jd. There is no reason to not raise the limit to 100000.</p>
<p>See the soft and hard limits with:</p>
<pre><code>...$ ulimit -n</code></pre>
<p>If hard limit is high enough, it might be easiest, before starting J, to do:</p>
<pre><code>...$ ulimit -n 100000</code></pre>
<p>To increase file handle limit for Linux Jd user fred: <code>...$ ulimit -n # show current file handle limit</code></p>
<pre><code>run superuser text editor and open /etc/security/limits.conf
add following 2 lines at the end

fred soft nofile 200000
fred hard nofile 200000

save the file, restart system, and verify new ulimit</code></pre>
<p>To increase file handle limit for Mac the steps are similar, but of course different, and details are left to the reader. Yosemite has a low soft limit and a high hard limit.</p>
<h2 id="links">Links</h2>
<p>Folder symbolic links (Windows folder junctions) are used to place db cols on different drives.</p>
<p>Possible benefits:</p>
<ul>
<li>i/o load balancing across drives</li>
<li>some cols can be placed on ssd drives</li>
<li>total db size irrelevant - only limit is biggest col must fit on a drive</li>
</ul>
<p>See Admin jdlinkmove, jdlinkset, and jdlinktargets for details.</p>
<p>See tutorial link.</p>
<h2 id="libjd.so">libjd.so</h2>
<p>Jd linux libjd.so shared library will run on most modern linux systems.</p>
<p>If Jd gets an error loading the linux shared library, please report the following to the J database forum:</p>
<pre><code>...$ cat /proc/version
...$ cat /etc/issue
...$ ldd .../libjd.so</code></pre>
<h2 id="locales">Locales</h2>
<p>Parts of a database (tables, cols, data) correspond directly with the file structure. That is, a table is a folder in the database, each col is a folder in its table folder, and data is a file in its col folder.</p>
<p>When a database is opened, J locales are created that correspond to the database structure. Each table has a locale with metadata and each col has a locale with metadata and mapped file(s) with the data.</p>
<p>Sometimes it can be useful to dig into the internals.</p>
<pre><code>   jdadminx&#39;test&#39;
   jd&#39;gen test f 3&#39;
   jd&#39;reads from f&#39;
   t=. jdgl_jd_&#39;f&#39;   NB. get locale for table f
   NAME__t           NB. table name
   NAMES__t          NB. col names in table
   c=. jdgl_jd_&#39;f x&#39; NB. get locale for col x in table f
   typ__c            NB. column type
   PATH__c           NB. path to col dat file
   dat__c            NB. mapped file data</code></pre>
<h2 id="performance">Performance</h2>
<p>See pmhelp_jd_ for info.</p>
<p>Folder pm has scripts for performance measurement.</p>
<h2 id="ref">Ref</h2>
<p>.../db/tab/refcol/jdstate has dirty flag and starts as 1</p>
<p>set 0 whenever ref col is recalculated</p>
<p>set 1 when delete/update/insert done to either table</p>
<p>jdstate written whenever dirty flag changes db can be closed with dirty 1</p>
<h2 id="windows-search-service">Windows search service</h2>
<p>Windows Search Service (content indexing, ...) can cause lots of disk activity and can interfere with Jd file operations and if possible should be disabled when using Jd.</p>
<p>Disable Windows Search Service as follows:</p>
<ol>
<li>command prompt ...&gt;services.msc</li>
<li>scroll down and right click Windows Search</li>
<li>click Properties</li>
<li>click Stop button to stop service if it is running</li>
<li>change Startup type: to Disabled</li>
<li>click Apply</li>
</ol>
</body>
</html>
